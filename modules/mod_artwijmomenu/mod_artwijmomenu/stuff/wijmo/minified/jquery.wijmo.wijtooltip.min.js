/*
 *
 * Wijmo Library 1.0.0
 * http://wijmo.com/
 *
 * Copyright(c) ComponentOne, LLC.  All rights reserved.
 * 
 * Dual licensed under the MIT or GPL Version 2 licenses.
 * licensing@wijmo.com
 * http://www.wijmo.com/license
 *
 **/
"use strict";(function(a){a.widget("wijmo.wijtooltip",{options:{content:"",title:"",closeBehavior:"auto",mouseTrailing:false,triggers:"hover",position:{my:"left bottom",at:"right top",offset:null},showCallout:true,showAnimation:{animated:"fade",duration:500},hideAnimation:{animated:"fade",duration:500},showDelay:150,hideDelay:150,calloutAnimation:{},calloutFilled:true,modal:false},_setOption:function(c,d){var b=this;if(a.isPlainObject(d))d=a.extend(b.options[c],d);c==="position"&&b.element.data("oldPos",b.options[c]);a.Widget.prototype._setOption.apply(b,arguments);a.isFunction(b["_set_"+c])&&b["_set_"+c](d)},_setPositionOffset:function(l){var h=this,e=h.element.data("domElements").callout,c,i,d,j,b,g,f,k=h.options;e.stop(true,true);c=a.extend({duration:1e3},k.calloutAnimation);i=h.element.data("arrowClass").replace(/wijmo-wijtooltip-arrow-/,"");d=false;j=["tr","tc","tl","bl","bc","br"];a.each(j,function(b,a){if(i===a)d=true});b="";g=k.position.offset;if(g){f=g.split(" ");if(f.length===2)if(d)b=f[0];else b=f[1]}if(b!=="")if(l)if(d)e.css("left",b+"px");else e.css("top",b+"px");else if(d)e.animate({left:b},c.duration,c.easing);else e.animate({top:b},c.duration,c.easing)},_set_triggers:function(){this._attachEventToElement()},_set_position:function(c){var a=this,b;if(a.options.showCallout){if(!a.isCreateTooltip){a._createTooltip();a.isCreateTooltip=true}b=a.element.data("oldPos");if(b.my!==c.my||b.at!==c.at){a._setCalloutCss();a._setposition()}a._setPositionOffset()}},_removeCalloutCss:function(){var a=this.element.data("tooltip");a&&a.removeClass("wijmo-wijtooltip-arrow-tr wijmo-wijtooltip-arrow-tc wijmo-wijtooltip-arrow-tl wijmo-wijtooltip-arrow-br wijmo-wijtooltip-arrow-bc wijmo-wijtooltip-arrow-bl wijmo-wijtooltip-arrow-rb wijmo-wijtooltip-arrow-rc wijmo-wijtooltip-arrow-rt wijmo-wijtooltip-arrow-lb wijmo-wijtooltip-arrow-lc wijmo-wijtooltip-arrow-lt")},_set_showCallOut:function(c){var a=this,b;a._removeCalloutCss();b=a.element.data("domElements");if(c){if(!a.isCreateTooltip){a._createTooltip();a.isCreateTooltip=true}a._setCalloutCss();b&&b.callout.show()}else b&&b.callout.hide()},_set_closeBehavior:function(){var a=this;if(!a.isCreateTooltip){a._createTooltip();a.isCreateTooltip=true}a._setCloseBtnCss()},_set_mouseTrailing:function(){this.element.unbind(".tooltip");this._attachEventToElement()},destroy:function(){var c=this,b=c.element;b.unbind(".tooltip");c.isCreateTooltip=false;a.Widget.prototype.destroy.apply(c);b.data("tooltip")&&b.data("tooltip").remove();b.attr("title",c.title);b.removeData("tooltip").removeData("arrowClass").removeData("domElements").removeData("fixedArrowClass").removeData("offset").removeData("oldPos").removeData("showDelay")},widget:function(){return this.element.data("tooltip")||this.element},_create:function(){var a=this,c=a.options,b=a.element;b.data("oldPos",c.position);c.position.of=b;a._attachEventToElement();b.data("offset",c.position.offset);a.isCreateTooltip=false},_createTooltip:function(){var a=this,c,d,b=a.element;a._setStructure();a._initializeDomElements();c=b.data("domElements");d=b.data("tooltip");b.attr("id")!==""&&d.attr("aria-describedby",b.attr("id"));d.hide();a._setCalloutCss();if(a.options.showCallout)c.callout.show();else c.callout.hide()},_setStructure:function(){var b=a("<div>"),e=this,g=a("<div class='wijmo-wijtooltip-container'>"),h=a("<div class='ui-widget-content wijmo-wijtooltip-pointer '><div class='wijmo-wijtooltip-pointer-inner'></div></div>"),d=a("<div>"),c=a("<a href='#'></a>"),f=a("<span>");b.addClass("wijmo-wijtooltip");c.addClass("wijmo-wijtooltip-close ui-state-default ui-corner-all");f.addClass("ui-icon ui-icon-close");c.append(f);e.element.data("domElements",{container:g,callout:h,closebtn:c,title:d});d.addClass("wijmo-wijtooltip-title ui-widget-header ui-corner-all");b.append(d);b.append(c);b.append(g);b.append(h);b.addClass("ui-widget ui-widget-content ui-corner-all");b.css("position","absolute").attr("role","tooltip");b.appendTo("body");e.element.data("tooltip",b);e._setCloseBtnCss()},_setCloseBtnCss:function(){var a=this.element.data("domElements");if(this.options.closeBehavior==="sticky")a.closebtn.show();else a.closebtn.hide()},_setCalloutCss:function(){var b=this,f=this.options,h=f.position.my,d,e,c=h.split(" "),a="",g;if(!f.showCallout){f.position.offset=b.element.data("offset");return}if(c.length===2){a+=c[0].substr(0,1);a+=c[1].substr(0,1)}d=f.position.at.split(" ");if(c[0]===d[0]){if(c[1]==="top"&&d[1]==="bottom"||c[1]==="bottom"&&d[1]==="top")a=a.substr(1,1)+a.substr(0,1)}else if(d[0]==="center")a=a.substr(1,1)+a.substr(0,1);if(a.substr(0,1)==="c")a=a.substr(1,1)+a.substr(0,1);if(b.element.data("arrowClass")){e=b.element.data("arrowClass");e=e.substr(e.length-2,1)}a="wijmo-wijtooltip-arrow-"+a;g=b.element.data("tooltip");b._removeCalloutCss();g.addClass(a);b.element.data("arrowClass",a)},_initializeDomElements:function(){var b=this,c=b.element.data("tooltip");c.bind("mouseout",a.proxy(b._onMouseOutTooltipElement,b));c.bind("mouseover",a.proxy(b._onMouseOverTooltipElement,b));b.element.data("domElements").closebtn.bind("click",a.proxy(b._onClickCloseBtn,b))},_attachEventToElement:function(){var a=this,c=a.options,b=a.element;if(a.title===undefined){a.title=b.attr("title");b.attr("title","")}b.unbind(".tooltip");c.mouseTrailing&&b.bind("mousemove.tooltip",function(){a._setposition();a.show()});switch(c.triggers){case"hover":b.bind("mouseover.tooltip",function(){a.show()}).bind("mouseout.tooltip",function(){if(c.closeBehavior==="sticky"||c.modal||c.closeBehavior==="none")return;a.hide()});break;case"click":b.bind("click.tooltip",function(){a.show()});break;case"focus":b.bind("focus.tooltip",function(){a.show()}).bind("blur.tooltip",function(){if(c.closeBehavior==="sticky")return;a.hide()});break;case"rightClick":b.bind("contextmenu.tooltip",function(b){a.show();b.preventDefault()})}},_isPointInsideRectWithOutBorder:function(c,e){var d=a(e),b={X:d.offset().left,Y:d.offset().top,Width:d.outerWidth(true),Height:d.outerHeight(true)};return c.X<=b.X||c.X>=b.X+b.Width?false:c.Y<=b.Y||c.Y>=b.Y+b.Height?false:true},_onMouseOutTooltipElement:function(b){var a=this,c=a.options;if(c.closeBehavior==="sticky"||c.closeBehavior==="none")return;!a._isPointInsideRectWithOutBorder({X:b.pageX,Y:b.pageY},a.element.data("tooltip"))&&a.hide()},_onMouseOverTooltipElement:function(c){var a=this,d=a.options,b=a.element;if(d.closeBehavior==="auto"&&!d.mouseTrailing)(!b.data("currentElement")||a._isPointInsideRectWithOutBorder({X:c.pageX,Y:c.pageY},b.data("currentElement")))&&a.hide()},_onClickCloseBtn:function(a){this.hide();a.preventDefault()},_setposition:function(){var h=this,f=h.options,i=h.element,d=i.data("tooltip"),p=d.is(":hidden"),e,g,j,t,l,b,c,v,o,n,u,m,s,r,k,q;p&&d.show();e=a.extend(f.position,{});d.css({left:0,top:0});g="";if(f.showCallout){j=i.data("arrowClass");t=j.substr(j.length-2,2);l=t.split("");b=[];b[0]=b[1]=0;c=i.data("domElements").callout;v=c.css("border-top-width").replace(/px/g,"")*1;o=c.css("border-left-width").replace(/px/g,"")*1;n=c.css("border-right-width").replace(/px/g,"")*1;u=c.css("border-bottom-width").replace(/px/g,"")*1;m=c.css("top").replace(/px/g,"")*1;s=c.css("left").replace(/px/g,"")*1;r=c.css("right").replace(/px/g,"")*1;k=c.css("bottom").replace(/px/g,"")*1;switch(l[0]){case"l":b[0]=n;break;case"r":b[0]=-o;break;case"b":b[1]=k;break;case"t":b[1]=-m}switch(l[1]){case"t":b[1]=-m;break;case"b":b[1]=k;break;case"r":b[0]=r;break;case"l":b[0]=-s}g=b.join(" ")}d.position({my:e.my,at:e.at,of:e.of,offset:g,collision:"none none"});q=d.offset();d.css({left:0,top:0});i.data("fixedArrowClass",false);d.position({my:e.my,at:e.at,of:e.of,offset:g,collision:e.collision});if(f.showCallout){h._calloutflip(q);h._set_unfilledCallout()}p&&!(f.relativeTo==="mouse"&&f.mouseTrailing)&&d.hide()},_set_unfilledCallout:function(c){var e=this,b=e.element,d=b.data("tooltip"),f=b.data("domElements"),a=f.callout.children();if(!c){c=b.data("arrowClass");if(b.data("fixedArrowClass"))c=b.data("fixedArrowClass")}a.css({"border-left-color":"","border-top-color":"","border-bottom-color":"","border-right-color":""});if(e.options.calloutFilled)switch(c){case"lt":case"lc":case"lb":a.css("border-right-color",d.css("background-color"));break;case"tl":case"tc":case"tr":a.css("border-bottom-color",d.css("background-color"));break;case"rt":case"rc":case"rb":a.css("border-left-color",d.css("background-color"));break;case"bl":case"bc":case"br":a.css("border-top-color",d.css("background-color"))}},_calloutflip:function(d){var h=this,i=h.element,g=i.data("tooltip"),c={left:false,top:false},j=h.options,f=a(window),e,b;if(j.position.at[0]!=="center"){if(d.left<0)c.left=true;e=d.left+g.width()-f.width()-f.scrollLeft();if(e>0)c.left=true}if(j.position[1]!=="center"){e=d.top+g.height()-f.height()-f.scrollTop();if(d.top<0)c.top=true;if(e>0)c.top=true}b=i.data("arrowClass");b=b.substr(b.length-2,2);if(c.left)if(b.indexOf("l")>-1)b=b.replace(/l/,"r");else if(b.indexOf("r")>-1)b=b.replace(/r/,"l");if(c.top)if(b.indexOf("t")>-1)b=b.replace(/t/,"b");else if(b.indexOf("b")>-1)b=b.replace(/b/,"t");if(c.left||c.top){h._removeCalloutCss();g.addClass("wijmo-wijtooltip-arrow-"+b)}i.data("fixedArrowClass",b)},_showTooltip:function(){var c=this,j=c.element,e=c.options,g,d,h,b,i={ui:c,cancel:false},f=j.data("tooltip");if(!f)return;c._trigger("showing",i);if(i.cancel)return;c._showModal();f.css("z-index",99999);if(e.showAnimation.animated&&!e.mouseTrailing){g={show:true,context:f,complete:function(){c._trigger("shown")}};d=a.wijmo.wijtooltip.animations;h=e.showAnimation.duration;b=e.showAnimation.animated;if(b&&!d[b]&&!a.easing[b])b="fade";if(!d[b])d[b]=function(a){this.slide(a,{easing:b,duration:h||700})};d[b](e.showAnimation,g)}else{f.show();c._trigger("shown")}c._setPositionOffset(true)},_hideTooltip:function(){var c=this,f=c.options,i=new a.Event("hidding.tooltip"),d,g,e,h,b;i.data={ui:c,cancel:false};c._trigger("hidding");if(i.data.cancel)return;c._hideModal();d=c.element.data("tooltip");if(!d)return;if(f.hideAnimation.animated){g={show:false,context:d,complete:function(){c._trigger("hidden");d.css("z-index","")}};e=a.wijmo.wijtooltip.animations;h=f.hideAnimation.duration;b=f.hideAnimation.animated;if(b&&!e[b]&&!a.easing[b])b="fade";if(!e[b])e[b]=function(a){this.slide(a,{easing:b,duration:h||700})};e[b](f.hideAnimation,g)}else{d.hide();c._trigger("hidden");d.css("z-index","")}},_setText:function(){var f=this,g=f.element,b=g.data("domElements"),h,i,d,c,e=f.options.content;if(a.isFunction(e)){i=e.call(g,function(a){a&&b.container.html(a)});i&&b.container.html(i)}else if(e!=="")b.container.html(e);else b.container.html(g?f.title:"");b.title.show();d=f.options.title;c="";if(a.isFunction(d)){h=d.call(g,function(a){if(a)c=a});if(h)c=h}else if(d!=="")c=d;if(c!==""){b.title.show();b.title.html(c)}else b.title.hide()},_getDocHeight:function(){var b,c;if(a.browser.msie&&a.browser.version<7){b=Math.max(document.documentElement.scrollHeight,document.body.scrollHeight);c=Math.max(document.documentElement.offsetHeight,document.body.offsetHeight);return b<c?a(window).height()+"px":b+"px"}else return a(document).height()+"px"},_getDocWidth:function(){var b,c;if(a.browser.msie&&a.browser.version<7){b=Math.max(document.documentElement.scrollWidth,document.body.scrollWidth);c=Math.max(document.documentElement.offsetWidth,document.body.offsetWidth);return b<c?a(window).width()+"px":b+"px"}else return a(document).width()+"px"},_showModal:function(){var c=this,b;if(c.options.modal){b=a("<div>");b.addClass("ui-widget-overlay").css("z-index",99000).width(c._getDocWidth()).height(c._getDocHeight());b.appendTo("body");c.element.data("modalDiv",b)}},_hideModal:function(){this.element.data("modalDiv")&&this.element.data("modalDiv").css("z-index","").remove()},show:function(){var b=this,d,c=b.element;if(!b.isCreateTooltip){b._createTooltip();b.isCreateTooltip=true}d=c.data("tooltip");d.stop(true,true);b._setText();c.data("arrowClass")&&d.removeClass(c.data("arrowClass"));b._setCalloutCss();b._setposition();clearTimeout(c.data("showDelay"));c.data("showDelay",setTimeout(a.proxy(b._showTooltip,b),b.options.showDelay))},showAt:function(c){var g,u,t,d=this,p=d.element,f,e,r,i,s,q,h,j,b,l,k,m,n,o;if(!d.isCreateTooltip){d._createTooltip();d.isCreateTooltip=true}g=p.data("tooltip");g.stop(true,true);d._setText();g.offset({left:0,top:0});g.show();f=0;e=0;r=p.data("arrowClass");i=p.data("domElements").callout;f=i.position().left;e=i.position().top;s=i.css("border-top-width").replace(/px/g,"")*1;q=i.css("border-left-width").replace(/px/g,"")*1;u=i.css("border-right-width").replace(/px/g,"")*1;t=i.css("border-bottom-width").replace(/px/g,"")*1;h=q===0?u:q;j=s===0?t:s;b={};l=g.width();k=g.height();m=(d.options.position.collision||"flip").split(" ");if(m.length===1)m[1]=m[0];switch(r){case"wijmo-wijtooltip-arrow-rt":b.left=c.x-l-h;b.top=c.y-e;break;case"wijmo-wijtooltip-arrow-rc":b.left=c.x-l-h;b.top=c.y-k/2;break;case"wijmo-wijtooltip-arrow-rb":b.left=c.x-l-h;b.top=c.y-e-j;break;case"wijmo-wijtooltip-arrow-lt":b.left=c.x+h;b.top=c.y-e;break;case"wijmo-wijtooltip-arrow-lc":b.left=c.x-f;b.top=c.y-k/2;break;case"wijmo-wijtooltip-arrow-lb":b.left=c.x-f;b.top=c.y-e-j;break;case"wijmo-wijtooltip-arrow-tl":b.left=c.x-f;b.top=c.y-e;break;case"wijmo-wijtooltip-arrow-tc":b.left=c.x-l/2;b.top=c.y-e;break;case"wijmo-wijtooltip-arrow-tr":b.left=c.x-f-h;b.top=c.y-e;break;case"wijmo-wijtooltip-arrow-bl":b.left=c.x-f;b.top=c.y-k-j;break;case"wijmo-wijtooltip-arrow-bc":b.left=c.x-l/2;b.top=c.y-k-j;break;case"wijmo-wijtooltip-arrow-br":b.left=c.x-f-h;b.top=c.y-k-j}n=d._showAtflip(r,b);o=[];o[0]=n.substr(0,1);o[1]=n.substr(1,1);a.each(o,function(c,a){switch(a){case"l":b.left+=1;break;case"r":b.left-=1;break;case"t":b.top+=1;break;case"b":b.top-=1}});d._set_unfilledCallout(n);g.offset(b);g.hide();p.data("showDelay",setTimeout(a.proxy(d._showTooltip,d),d.options.showDelay))},_showAtflip:function(n,c){var j=this,p=j.element,e=(j.options.position.collision||"flip").split(" "),b,f,h,g,d,o,m,i,l,k;if(e[0]!=="flip"&&e[1]!=="flip")return;b=n.substr(n.length-2,2);f=p.data("tooltip");h=f.width();g=f.height();d=p.data("domElements").callout;o=d.css("border-top-width").replace(/px/g,"")*1;m=d.css("border-left-width").replace(/px/g,"")*1;i=d.css("border-right-width").replace(/px/g,"")*1;l=d.css("border-bottom-width").replace(/px/g,"")*1;k=a(window);if(e[1]==="flip"){if(b.indexOf("t")>-1)if(c.top+g>k.height()){c.top-=g+l*2;b=b.replace(/t/,"b")}if(b.indexOf("b")>-1)if(c.top<0){c.top+=g+o*2;b=b.replace(/b/,"t")}}if(e[0]==="flip"){if(b.indexOf("l")>-1)if(c.left+h>k.width()){c.left-=h+i*2;b=b.replace(/l/,"r")}if(b.indexOf("r")>-1)if(c.left-i<0){c.left+=h+m*2;b=b.replace(/r/,"l")}}j._removeCalloutCss();f.addClass("wijmo-wijtooltip-arrow-"+b);return b},hide:function(){var b=this,c=b.element;clearTimeout(c.data("showDelay"));clearTimeout(c.data("hideDelay"));c.data("hideDelay",setTimeout(a.proxy(b._hideTooltip,b),b.options.hideDelay))}});a.extend(a.wijmo.wijtooltip,{animations:{fade:function(b,c){b=a.extend({duration:300,easing:"swing"},b,c);b.context.stop(true,true).animate(b.show?{opacity:"show"}:{opacity:"hide"},b)}}})})(jQuery);