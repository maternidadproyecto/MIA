/*
 *
 * Wijmo Library 1.0.0
 * http://wijmo.com/
 *
 * Copyright(c) ComponentOne, LLC.  All rights reserved.
 * 
 * Dual licensed under the MIT or GPL Version 2 licenses.
 * licensing@wijmo.com
 * http://www.wijmo.com/license
 *
 **/
"use strict";(function(a){a.widget("wijmo.wijprogressbar",a.ui.progressbar,{options:{labelAlign:"center",maxValue:100,minValue:0,fillDirection:"east",labelFormatString:"{1}%",toolTipFormatString:"{1}%",indicatorIncrement:1,indicatorImage:"",animationDelay:0,animationOptions:{animated:"progress",duration:500}},_setOption:function(d,c){var e,b=this;switch(d){case"value":e=parseInt(c,10);b.options[d]=e;b._refreshValue(e);break;case"maxValue":case"minValue":e=parseInt(c,10);b.options[d]=e;b[d==="maxValue"?"max":"min"]=e;b._refreshValue();break;case"labelFormatString":case"toolTipFormatString":b.options[d]=c;b._refreshValue();break;case"orientation":case"fillDirection":case"labelAlign":case"indicatorImage":b.options[d]=c;b._initElements();b._refreshValue();break;case"indicatorIncrement":c=c===0?1:c;b.options[d]=c;b._initElements();b._refreshValue()}a.Widget.prototype._setOption.apply(b,arguments)},_create:function(){var b=this;b.min=b.options.minValue;b.max=b.options.maxValue;b.element.addClass("wijmo-wijprogressbar");a.ui.progressbar.prototype._create.apply(b,arguments);b.label=a("<span>").addClass("ui-progressbar-label ui-corner-left").appendTo(b.element);b._initElements();b._isInit=true;b._refreshValue()},_triggerEvent:function(c,e,d,f){var b=a.Event(c);b.data={oldValue:e,newValue:d,cancel:f};this._trigger(c,b);return b.data.cancel},_refreshValue:function(){var b=this,c,d,e,g,f;if(!b._isInit)return;c=b.value();d=(c-b.min)/(b.max-b.min)*100;e=b.options;g=b._triggerEvent("beforeProgressChanging",b.element.attr("aria-valuenow"),c,false);if(g)return;b.valueDiv.css({width:"",height:""});if(e.animationOptions.animated&&e.animationOptions.duration>0)setTimeout(a.proxy(function(){var g=b.options.animationOptions,h={content:b.valueDiv,complete:a.proxy(function(){b._triggerEvent("progressChanged",b.element.attr("aria-valuenow"),c,false)},b),step:a.proxy(function(a){b._performAnimating(a)},b),processValue:d},f=a.wijmo.wijprogressbar.animations,i=g.duration,e=g.animated;if(e&&!f[e])e="progress";if(!f[e])f[e]=function(a){this.progress(a,{easing:e,duration:i||1e3})};f[e](h,b.options.animationOptions)},b),b.options.animationDelay);else{f=b.element.attr("aria-valuenow");b._refreshProgress(d);b._triggerEvent("progressChanged",f,c,false)}},_setLabelSide:function(){var a=this,b=a.options.labelAlign;if(a._isHorizontal())if(b==="west"||b==="east"||b==="center")a.label.css("width",a.element.width()+"px");else if(b==="running")a.label.css("width","auto");else{a.element.css("line-height","normal");a.valueDiv.css("line-height","normal");a.label.css("height",b==="north"?a.element.height()+"px":"auto")}else if(b==="west"||b==="east"||b==="center")a.label.css({"line-height":a.element.height()+"px",width:a.element.width()+"px"});else if(b==="running")a.label.css({height:"auto",width:a.element.width()+"px"});else{a.element.css("line-height","normal");a.valueDiv.css("line-height","normal")}},_isHorizontal:function(){return this.options.fillDirection==="west"||this.options.fillDirection==="east"},startTask:function(){if(a(":animated",this.element).length===0){var b=this.value();this._refreshValue(b)}},stopTask:function(){this.valueDiv.stop()},_initElements:function(){var a=this,c=a.options,b;a.element.removeClass("wijmo-wijprogressbar-west wijmo-wijprogressbar-east wijmo-wijprogressbar-north wijmo-wijprogressbar-south").addClass("wijmo-wijprogressbar-"+c.fillDirection);b=a.element.height();a.valueDiv.css("line-height","");a.label.removeClass("lb_west lb_east lb_south lb_north lb_center lb_running").addClass("lb_"+c.labelAlign).css("line-height","").css({left:"",right:"",top:"",bottom:""});if(a._isHorizontal())a.valueDiv.height(b).css("line-height",b+"px");else a.valueDiv.width(a.element.width());a._setLabelSide();a.options.indicatorImage!==""&&a.valueDiv.css("background","transparent url("+a.options.indicatorImage+") repeat fixed")},_refreshProgress:function(b){var a=this,c=a.options,f,e,d=b*(a.max-a.min)/100+a.min,g=a._triggerEvent("progressChanging",a.element.attr("aria-valuenow"),d,false);if(g)return;if(a._isHorizontal())a.valueDiv.toggleClass(c.fillDirection==="east"?"ui-corner-right":"ui-corner-left",b===a.max).width(b+"%");else a.valueDiv.toggleClass(c.fillDirection==="south"?"ui-corner-bottom":"ui-corner-top",b===a.max).height(b+"%");a.element.attr("aria-valuenow",d);f=a._getFormatString(c.labelFormatString,b);a._setLabelsText(f);e=a._getFormatString(c.toolTipFormatString,b);a.element.attr("title",e)},_performAnimating:function(b){var a=this,i=a.options,k,d,f,h,j,c,e,g,l;if(a.options.indicatorIncrement!==1){k=Math.floor(b/a.options.indicatorIncrement);b=k*a.options.indicatorIncrement}else b=Math.round(b);a._refreshProgress(b);if(i.labelAlign==="running")if(a._isHorizontal()){d=a.element.width();f=a.label.outerWidth();h=a.valueDiv.outerWidth();j=d===h?d-f:b*d/100-f+f*(d-h)/d;a.label.css(i.fillDirection==="east"?"left":"right",j)}else{c=a.element.height();e=a.label.outerHeight();g=a.valueDiv.outerHeight();l=c===g?c-e:b*c/100-e+e*(c-g)/c;a.label.css(i.fillDirection==="south"?"top":"bottom",l)}},_setLabelsText:function(a){if(!this._isHorizontal()&&this.options.labelAlign==="rightOrBottom"){this.label.html("<span style='position:absolute;bottom:0px;text-align:center;width:"+this.element.width()+"px;'>"+a+"</span>");return}this.label.html(a)},_getFormatString:function(a,h){var c=this,d=parseInt(c.element.attr("aria-valuenow"),10),f=c.max-d,g=h,e=100-h,b=/\{0\}/g;a=a.replace(b,d.toString());b=/\{ProgressValue\}/g;a=a.replace(b,d.toString());b=/\{1\}/g;a=a.replace(b,g.toString());b=/\{PercentProgress\}/g;a=a.replace(b,g.toString());b=/\{2\}/g;a=a.replace(b,f.toString());b=/\{RemainingProgress\}/g;a=a.replace(b,f.toString());b=/\{3\}/g;a=a.replace(b,e.toString());b=/\{PercentageRemaining\}/g;a=a.replace(b,e.toString());b=/\{4\}/g;a=a.replace(b,c.min);b=/\{Min\}/g;a=a.replace(b,c.min);b=/\{5\}/g;a=a.replace(b,c.max);b=/\{Max\}/g;a=a.replace(b,c.max);return a},destroy:function(){this.element.empty().attr("aria-valuemax","").attr("aria-valuemin","").attr("aria-valuenow","");this.element.removeClass("wijmo-wijprogressbar ui-widget ui-widget-content ui-corner-all wijmo-wijprogressbar-h").attr("title","").attr("role","");a.Widget.prototype.destroy.apply(this,arguments)}});a.extend(a.wijmo.wijprogressbar,{animations:{progress:function(b,c){b=a.extend({easing:"swing",duration:1e3},b,c);b.content.stop(true,true).animate({widthvalue:b.processValue},b)}}})})(jQuery);