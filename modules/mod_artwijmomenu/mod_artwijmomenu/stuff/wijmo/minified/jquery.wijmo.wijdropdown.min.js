/*
 *
 * Wijmo Library 1.0.0
 * http://wijmo.com/
 *
 * Copyright(c) ComponentOne, LLC.  All rights reserved.
 * 
 * Dual licensed under the MIT or GPL Version 2 licenses.
 * licensing@wijmo.com
 * http://www.wijmo.com/license
 *
 **/
"use strict";(function(a){a.widget("wijmo.wijdropdown",{options:{width:200,height:250,zIndex:1e3,showingAnimation:{effect:"blind"},hidingAnimation:{effect:"blind"}},hoverClass:"ui-state-hover",activeClass:"ui-state-active",focusClass:"ui-state-focus",_create:function(){if(this.element.attr("tagName").toLowerCase()!=="select"&&this.element.attr("size")<2)return;this._activeItem=null;this._applySelect(this.element)},_applySelect:function(e){var b=this,h=a(e).outerHeight(),g,f,d,c,j,i;a(e).wrap("<div></div>");a(e).wrap("<div></div>");g=a(e).parent().addClass("ui-helper-hidden");f=g.parent().attr("role","select").addClass("wijmo-wijdropdown ui-widget ui-widwijmo-wijdropdownt-content ui-state-default ui-corner-all ui-helper-clearfix");d=a('<label class="wijmo-dropdown-label ui-corner-all"></label>').attr("id",b.element.attr("id")+"_select").attr("name",a(e).attr("name"));c=a("<div></div>").addClass("wijmo-dropdown-trigger ui-state-default ui-corner-right");j=a("<span></span>").addClass("ui-icon ui-icon-triangle-1-s").appendTo(c);b._value=a(e).val();b.$anthorWarp=a('<a href="#"></a>');b.$anthorWarp.append(d);b.div=a("<div>");f.append(b.$anthorWarp);f.append(c);f.append(b.div);f.css({width:b.options.width});b.div.addClass("wijmo-dropdown");d.data("dropdown",b.div);b.$dropdownList=a("<ul></ul>").addClass("wijmo-dropdown-list ui-widget-content ui-widget ui-corner-all ui-helper-reset").appendTo(b.div);b.element.children().each(function(){var c=a(this),f,d,e,g;if(c.is("option")){f=a(this);b.$dropdownList.append(b._buildItem(f))}else if(c.is("optgroup")){e=a('<li class="wijmo-dropdown-optgroup"></li>');g=a("<span>"+c.attr("label")+"</span>").addClass("wijmo-optgroup-header ui-priority-primary");d=a("<ul></ul>").addClass("ui-helper-reset wijmo-dropdown-items");e.append(g).append(d);c.children("option").each(function(){var c=a(this);d.append(b._buildItem(c))});b.$dropdownList.append(e)}});d.bind("click."+b.widgetName,function(a){if(!b.div.is(":visible"))b._show();else b._hide();a.preventDefault()}).bind("mouseover."+b.widgetName,function(){d.addClass(b.hoverClass);c.addClass(b.hoverClass)}).bind("mouseout."+b.widgetName,function(){d.removeClass(b.hoverClass);c.removeClass(b.hoverClass)}).bind("mousedown."+b.widgetName,function(){d.addClass(b.activeClass);c.addClass(b.activeClass)}).bind("mouseup."+b.widgetName,function(){d.removeClass(b.activeClass);c.removeClass(b.activeClass)});c.bind("click."+b.widgetName,function(){if(!b.div.is(":visible"))b._show();else b._hide();b.$anthorWarp.focus()}).bind("mouseover."+b.widgetName,function(){d.addClass(b.hoverClass);c.addClass(b.hoverClass)}).bind("mouseout."+b.widgetName,function(){d.removeClass(b.hoverClass);c.removeClass(b.hoverClass)}).bind("mousedown."+b.widgetName,function(){d.addClass(b.activeClass);c.addClass(b.activeClass)}).bind("mouseup."+b.widgetName,function(){d.removeClass(b.activeClass);c.removeClass(b.activeClass)});a(document.body).bind("click."+b.widgetName,function(a){var f=b.div,e;if(f.is(":hidden"))return;e=f.offset();if(a.target===d.get(0)||a.target===c.get(0)||a.target===c.children().get(0))return;(a.pageX<e.left||a.pageX>e.left+f.width()||a.pageY<e.top||a.pageY>e.top+f.height())&&b._hide()});b.div.bind("click."+b.widgetName,function(c){var d=a(c.target);if(d.closest("li.wijmo-dropdown-item",a(this)).length>0){b._setValue();a(this).hide()}});h=Math.min(b.options.height,b.$dropdownList.outerHeight());i=b._getMaxZIndex();b.div.css({height:h,width:b.options.width});b.superpanel=b.div.wijsuperpanel().data("wijsuperpanel");a.fn.bgiframe&&b.superpanel.element.bgiframe();b.$dropdownList.setOutWidth(b.$dropdownList.parent().parent().innerWidth());b.div.hide();b.$anthorWarp.bind("keydown."+b.widgetName,function(d){var c=a.ui.keyCode;switch(d.which){case c.UP:case c.LEFT:b.previous();b._setValue();d.preventDefault();break;case c.DOWN:case c.RIGHT:b.next();b._setValue();d.preventDefault();break;case c.PAGE_DOWN:b.nextPage(true);b._setValue();d.preventDefault();break;case c.PAGE_UP:b.previousPage(true);b._setValue();d.preventDefault();break;case c.ENTER:case c.NUMPAD_ENTER:b._setValue();b.div.hide();d.preventDefault()}}).bind("focus."+b.widgetName,function(){d.addClass(b.focusClass);c.addClass(b.focusClass)}).bind("blur."+b.widgetName,function(){d.removeClass(b.focusClass);c.removeClass(b.focusClass)})},_init:function(){var a=this;a._initActiveItem();a._activeItem&&a.$anthorWarp.children("label").text(a._activeItem.text())},_buildItem:function(b){var f=b.val(),e=b.text(),d=this,c=a('<li class="wijmo-dropdown-item ui-corner-all"><span>'+e+"</span></li>").mousemove(function(b){var c=a(b.target).closest(".wijmo-dropdown-item");c!==this.last&&d._activate(a(this));this.last=a(b.target).closest(".wijmo-dropdown-item")}).attr("role","option");c.data("value",f);return c},_show:function(){var d=this,b=d.options.showingAnimation,c=d.div;c.css("z-index","100000");a.browser.msie&&(a.browser.version==="6.0"||a.browser.version==="7.0")&&c.parent().css("z-index","99999");if(b)c.stop().show(b.effect,b.options,b.speed,function(){d._initActiveItem()});else c.show()},_hide:function(){var d=this,c=d.options.hidingAnimation,b=d.div;if(b.is(":hidden"))return;if(c)b.stop(false,true).hide(c.effect,c.options,c.speed,function(){a.isFunction(c.callback)&&c.callback.apply(d,arguments);(a.browser.msie&&a.browser.version==="6.0"||a.browser.version==="7.0")&&b.parent().css("z-index","");b.css("z-index","")});else{a.browser.msie&&a.browser.version==="6.0"&&b.parent().css("z-index","");b.css("z-index","");b.hide()}},_setValue:function(){var a=this,b=a.div,c,d;if(a._activeItem){a.$anthorWarp.children("label").text(a._activeItem.text());a._value=a._activeItem.data("value");if(a.superpanel.vNeedScrollBar){c=a._activeItem.offset().top;d=a._activeItem.outerHeight();if(b.offset().top>c)b.wijsuperpanel("scrollTo",0,c-a.$dropdownList.offset().top);else b.offset().top<c+d-b.innerHeight()&&b.wijsuperpanel("scrollTo",0,c+d-b.height()-a.$dropdownList.offset().top)}a.element.val(a._value)}},_initActiveItem:function(){var b=this;b._value&&b.$dropdownList.find("li.wijmo-dropdown-item").each(function(){a(this).data("value")===b._value&&b._activate(a(this))})},_activate:function(b){var a=this;a._deactivate();a._activeItem=b;a._activeItem.addClass(a.hoverClass).attr("aria-selected",true)},_deactivate:function(){var a=this;a._activeItem&&a._activeItem.removeClass(a.hoverClass).attr("aria-selected",false)},next:function(){this._move("next","first")},previous:function(){this._move("prev","last")},_move:function(c,d){var a=this,e,b;if(!a._activeItem){a._activate(a.$dropdownList.find(".wijmo-dropdown-item:"+d));return}e=a._activeItem[c]().eq(0);if(e.length)b=a._getNextItem(e,c,d);else if(a._activeItem.closest(".wijmo-dropdown-optgroup").length)b=a._getNextItem(a._activeItem.closest(".wijmo-dropdown-optgroup")[c](),c,d);if(b&&b.length)a._activate(b);else a._activate(a.$dropdownList.find(".wijmo-dropdown-item:"+d))},_getNextItem:function(a,b,c){if(a.length)if(a.is(".wijmo-dropdown-optgroup"))if(!!a.find(">ul>li.wijmo-dropdown-item").length)return a.find(">ul>li.wijmo-dropdown-item:"+c).eq(0);else this._getNextItem(a[b]().eq(0));else return a},_isFirst:function(){},_isLast:function(){},nextPage:function(){var b=this,e,d,c;if(b.superpanel.vNeedScrollBar){if(!b._activeItem||b._isLast()){b.activate(b.element.children(":first"));return}e=b._activeItem.offset().top;d=b.options.height;c=b.$dropdownList.find(".wijmo-dropdown-item").filter(function(){var c=a(this).offset().top-e-d+a(this).height(),b=a(this).height();return c<b&&c>-b});if(!c.length)c=b.$dropdownList.find(".wijmo-dropdown-item:last");b._activate(c)}else b._activate(b.$dropdownList.find(".wijmo-dropdown-item"+(!b._activeItem||b._isLast()?":first":":last")))},previousPage:function(){var b=this,e,d,c;if(b.superpanel.vNeedScrollBar){if(!b._activeItem||b._isLast()){b._activate(b.element.children(":last"));return}e=b._activeItem.offset().top;d=b.options.height;c=b.$dropdownList.find(".wijmo-dropdown-item").filter(function(){var c=a(this).offset().top-e+d-a(this).height(),b=a(this).height();return c<b&&c>-b});if(!c.length)c=b.$dropdownList.find(".wijmo-dropdown-item:first");b._activate(c)}else b._activate(b.$dropdownList.find(".wijmo-dropdown-item"+(!b._activeItem||b._isFirst()?":last":":first")))},_getMaxZIndex:function(){var c=this,b=100;if(c.element.data("maxZIndex"))return c.element.data("maxZIndex");a("*",document).each(function(d,c){if(window.parseInt(a(c).css("z-index"))>b)b=window.parseInt(a(c).css("z-index"))});c.element.data("maxZIndex",b);return b},destroy:function(){this.element.closest(".wijmo-wijdropdown").find(">div.wijmo-dropdown-trigger,>div.wijmo-dropdown,>label.wijmo-dropdown-label").remove();this.element.unwrap().unwrap().removeData("maxZIndex");a.Widget.prototype.destroy.apply(this)}})})(jQuery);