/*
 *
 * Wijmo Library 1.0.0
 * http://wijmo.com/
 *
 * Copyright(c) ComponentOne, LLC.  All rights reserved.
 * 
 * Dual licensed under the MIT or GPL Version 2 licenses.
 * licensing@wijmo.com
 * http://www.wijmo.com/license
 *
 **/
"use strict";(function(a){var g="ui-widget ui-widget-content ui-corner-all wijmo-wijlist",c="wijmo-wijlist-item",h=c+"-alternate",i=c+"-selected",j=c+"-first",k=c+"-last",f="ui-state-hover",l="ui-state-active",e="wijmo-wijlistitem-active",b=i+" "+l,d="item.wijlist";a.widget("wijmo.wijlist",{options:{selected:null,selectionMode:"single",autoSize:false,maxItemsCount:5,addHoverItemClass:true,superPanelOptions:null,disabled:false,focusing:null,focus:null,blur:null,itemrendering:null,itemrendered:null,listrendered:null,keepHightlightOnMouseLeave:false},_create:function(){var b=this,c=this.element,d=this.options;c.addClass(g).attr({role:"listbox","aria-activedescendant":e,"aria-multiselectable":d.selectionMode==="multiple"}).bind("click."+b.widgetName,b,b._onListClick);b.ul=a("<ul class='wijmo-wijlist-ul'></ul>").appendTo(c);d.disabled&&b.disable()},setItems:function(d){var b=this,c;b.items=d;c=a.grep(d,function(a){return a.selected});if(b.options.selectionMode==="single"){b.selectedItems=[];b.selectedItem=c.length>0?c[0]:undefined}else b.selectedItems=c},getList:function(){return this.ul},_onListClick:function(b){if(!a(b.target).closest(".wijmo-wijlist-item").length)return;var c=b.data;c.select(b)},destroy:function(){var b=this,c=this.element;b.superPanel!==undefined&&b.superPanel.destroy();c.removeClass(g).removeAttr("role").removeAttr("aria-activedescendant").unbind("."+b.widgetName);b.ul.remove();a.Widget.prototype.destroy.apply(b,arguments)},activate:function(d,b,g){var a=this,h,c;a.deactivate();if(b===null||b===undefined)return;if(a._trigger("focusing",d,b)===false)return;h=a.active=b;c=b.element;a.options.addHoverItemClass&&c.addClass(f);c.attr("id",e);g&&a.superPanel!==undefined&&a.superPanel.scrollChildIntoView(c);a._trigger("focus",d,b)},deactivate:function(){var a=this,b=a.active,c;if(!b)return;c=b.element;a._trigger("blur",null,b);c.removeClass(f).removeAttr("id");a.active=undefined},next:function(a){this.move("next","."+c+":first",a)},nextPage:function(){this.superPanel.doScrolling("bottom",true)},previous:function(a){this.move("prev","."+c+":last",a)},previousPage:function(){this.superPanel.doScrolling("top",true)},first:function(){return this.active&&!this.active.element.prev().length},last:function(){return this.active&&!this.active.element.next().length},move:function(h,f,b){var a=this,g,e;if(!a.active){g=a.ul.children(f).data(d);a.activate(b,g,true);return}e=a.active.element[h+"All"]("."+c).eq(0);if(e.length)a.activate(b,e.data(d),true);else a.activate(b,a.element.children(f).data(d),true)},select:function(i,j){var e=this,g=e.active.element,c,h,f;if(g===undefined)return;c=g.data(d);h=e.options.selectionMode==="single";if(h){f=e.selectedItem;g.addClass(b).attr("aria-selected","true");c.selected=true;if(f!==undefined&&c!==f){f.selected=false;f.element.removeClass(b).removeAttr("aria-selected")}e.selectedItem=c;e._trigger("selected",i,{item:c,previousItem:f,data:j})}else{c.selected=!c.selected;if(c.selected)g.addClass(b).attr("aria-selected","true");else g.removeClass(b).removeAttr("aria-selected","true");e.selectedItems=a.grep(e.items,function(a){return a.selected});e._trigger("selected",i,{item:c,selectedItems:e.selectedItems})}},_findItemsByValues:function(c){var b,d=[];d=a.grep(this.items,function(d){b=false;for(var a=0;a<c.length;a++)if(d.value===c[a])b=true;return b});return d},_findItemsByIndices:function(c){var d=this,e=this.items.length,b=[];a.each(c,function(c,a){a>=0&&a<e&&b.push(d.items[a])});return b},getItems:function(b){var g=this,f,c,d,e;c=a.isArray(b);f=!c&&!isNaN(b)||c&&!isNaN(b[0]);d=c?b:[b];e=f?g._findItemsByIndices(d):g._findItemsByValues(d);return e},selectItems:function(i,g){var c=this,h=this.options.selectionMode==="single",e,d,f;f=c.getItems(i);if(h){if(f.length>0){e=f[0];e.selected=true;e.element.addClass(b)}d=c.selectedItem;if(d){d.selected=false;d.element.removeClass(b)}c.selectedItem=e;g&&c._trigger("selected",null,{item:e,previousItem:d})}else{a.each(f,function(c,a){a.selected=true;a.element.addClass(b)});c.selectedItems=a.grep(c.items,function(a){return a.selected});g&&c._trigger("selected",null,{selectedItems:c.selectedItems})}},unselectItems:function(f){var c=this,g=this.options.selectionMode,d,e;if(g==="single"){d=c.selectedItem;if(d){d.selected=false;d.element.removeClass(b);c.selectedItem=undefined}}else{e=c.getItems(f);a.each(e,function(c,a){a.selected=false;a.element.removeClass(b)});c.selectedItems=a.grep(c.items,function(a){return a.selected})}},renderList:function(){var d=this,g=this.ul,h=this.options,a,c,e,b,f;g.empty();a=d.items;if(a===undefined)return;c=a.length;if(a===undefined||a===null&&c===0)return;e=h.selectionMode==="single";for(b=0;b<c;b++){f=a[b];d._renderItem(g,f,b,e)}a[0].element.addClass(j);a[c-1].element.addClass(k);d._trigger("listrendered",null,d)},_renderItem:function(k,c,j){var e=this,f=a("<li role='option' class='wijmo-wijlist-item ui-corner-all'></li>"),g,i;c.element=f;c.list=e;if(e._trigger("itemrendering",null,c)===false)return;g=c.label;if(c.text!==undefined)g=c.text;f.mouseenter(function(a){e.activate(a,c,false)}).mouseleave(function(){!e.options.keepHightlightOnMouseLeave&&e.deactivate()}).data(d,c).append(g).appendTo(k);i=c.imageUrl;i!==undefined&&i.length>0&&f.prepend("<img src='"+c.imageUrl+"'>");if(c.selected){e.activate(null,c,false);f.addClass(b)}j%2===1&&f.addClass(h);e._trigger("itemrendered",null,c)},refreshSuperPanel:function(){var d=this,f=this.element,m=this.options,b=this.ul,n=b.children(".wijmo-wijlist-item:first"),h=null,g,j,k,c,e,i,l;if(!f.is(":visible"))return false;if(m.autoSize)h=n.outerHeight(true)*m.maxItemsCount;h!==null&&f.height(Math.min(h,b.outerHeight()));g=f.innerHeight();j=g/(b.outerHeight()-g);e=101*j/(1+j);k=n.outerHeight()/(b.outerHeight()-g)*(101-e);if(d.superPanel===undefined){i={allowResize:false,keyboardSupport:false,bubbleScrollingEvent:true,hScroller:{scrollBarVisibility:"hidden"},vScroller:{scrollSmallChange:k,scrollLargeChange:e}};a.extend(i,m.superPanelOptions);d.superPanel=f.wijsuperpanel(i).data("wijsuperpanel")}else{c=d.superPanel.options.vScroller;c.scrollLargeChange=e;c.scrollSmallChange=k;d.superPanel.paintPanel()}l=b.css("padding-top");if(l.length>0){c=d.superPanel.options.vScroller;c.firstStepChangeFix=d.superPanel.scrollPxToValue(parseFloat(l),"v")}else c.firstStepChangeFix=0;b.setOutWidth(b.parent().parent().innerWidth())}})})(jQuery);